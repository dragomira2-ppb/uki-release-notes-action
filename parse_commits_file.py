from datetime import datetime
import re
import base64
from validate_env_variables import ENV_VARIABLES

def parse_commit_data():
#     input_release_commits = base64.b64decode(ENV_VARIABLES['COMMIT_MESSAGE_ENCODED']).decode('utf-8')
    input_release_commits = base64.b64decode('Y29tbWl0IDBkOGYwODYxNjgwMzhhZThkYTEzNzlkZmYzYjIzMDc0NWZkOTdjOGNAQXV0aG9yOiBkcmFnb21pcmEyIDxhbGV4YW5kcnUuZHJhZ29taXJAcHBiLmNvbT5ARGF0ZTogICBUdWUgSmFuIDMwIDEyOjQzOjA1IDIwMjQgKzAyMDBAQCAgICBNb2RpZmllZCByZWxlYXNlIHdvcmtmbG93IGFjdGlvbkBAY29tbWl0IGM4YzQyMzI4ZTIwZWNiYzVhNGYyYzFmNjNlNzg1ODBmYTNlZjI5MDFAQXV0aG9yOiBkcmFnb21pcmEyIDxhbGV4YW5kcnUuZHJhZ29taXJAcHBiLmNvbT5ARGF0ZTogICBUdWUgSmFuIDMwIDEyOjAzOjI5IDIwMjQgKzAyMDBAQCAgICBNb2RpZmllZCByZWxlYXNlIHdvcmtmbG93IGFjdGlvbkBAY29tbWl0IGRiNGMyYzY1ZDI4Y2IxZjMxNzBmNmY3MDU3NThlMTY5ZjM0NTA0MTVAQXV0aG9yOiBkcmFnb21pcmEyIDxhbGV4YW5kcnUuZHJhZ29taXJAcHBiLmNvbT5ARGF0ZTogICBUdWUgSmFuIDMwIDExOjM0OjI5IDIwMjQgKzAyMDBAQCAgICBNb2RpZmllZCByZWxlYXNlIHdvcmtmbG93IGFjdGlvbkBAY29tbWl0IDZlYWM5ZmViNjlkNWVkZTgzMDQwNzUxMjFhMGVmYzUzM2NlM2JiNjBAQXV0aG9yOiBEcmFnb21pciBBbGV4YW5kcnUgPDE0NzA1NzgzNStkcmFnb21pcmEyLXBwYkB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+QERhdGU6ICAgTW9uIEphbiAyOSAxNzowMjo1NCAyMDI0ICswMjAwQEAgICAgVXBkYXRlIHJlbGVhc2UueW1sQEBjb21taXQgZWViYTJlNTZiMDkzYjc3YWRkZWUxNzEzOWNjYTlhYTkwNzNhOWUxZkBBdXRob3I6IERyYWdvbWlyIEFsZXhhbmRydSA8MTQ3MDU3ODM1K2RyYWdvbWlyYTItcHBiQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbT5ARGF0ZTogICBNb24gSmFuIDI5IDE1OjAyOjI5IDIwMjQgKzAyMDBAQCAgICBtb2RpZmllZCBlbnYgdG8gcHJkQEBjb21taXQgNzdlYTk1ZmMzMDA2MjYyZmM2Y2U3NDNiZDM5OGNjY2EyMGIxMTZiN0BBdXRob3I6IERyYWdvbWlyIEFsZXhhbmRydSA8MTQ3MDU3ODM1K2RyYWdvbWlyYTItcHBiQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbT5ARGF0ZTogICBNb24gSmFuIDI5IDE1OjAyOjA5IDIwMjQgKzAyMDBAQCAgICBtb2RpZmllZCBlbnYgdG8gZW5kIGZvciB0ZXN0aW5nQEBjb21taXQgZDkzOWRiN2MyNGY3YTM5YjgzMzg2YTJlNDFhNWIyOGViZjUxZDRkYUBBdXRob3I6IGRyYWdvbWlyYTIgPGFsZXhhbmRydS5kcmFnb21pckBwcGIuY29tPkBEYXRlOiAgIE1vbiBKYW4gMjkgMTE6MjE6MzggMjAyNCArMDIwMEBAICAgIE1vZGlmaWVkIHJlbGVhc2Ugd29ya2Zsb3cgYWN0aW9uQEBjb21taXQgMWM3NGE2NmQ0MjgxMTYzZGRmM2VlOGI3ZWJmMTMzMmVhM2ZjYzBhYkBBdXRob3I6IGRyYWdvbWlyYTIgPGFsZXhhbmRydS5kcmFnb21pckBwcGIuY29tPkBEYXRlOiAgIE1vbiBKYW4gMjkgMTE6MTk6MjAgMjAyNCArMDIwMEBAICAgIE1vZGlmaWVkIHJlbGVhc2Ugd29ya2Zsb3cgYWN0aW9uQEBjb21taXQgNWE3YTE4YWNlMGViMzZlZTVjYzhhYzQxNGYxYzc3YWI4ZDQ5MGYyNEBBdXRob3I6IGRyYWdvbWlyYTIgPGFsZXhhbmRydS5kcmFnb21pckBwcGIuY29tPkBEYXRlOiAgIEZyaSBKYW4gMjYgMTc6MTk6NTYgMjAyNCArMDIwMEBAICAgIE1vZGlmaWVkIHJlbGVhc2Ugd29ya2Zsb3cgYWN0aW9uQEBjb21taXQgYjVlNTRkNDFmMTlkNmM4NGQ5YWRmZDNhZjA4ODVjZjllZmRmZWY4N0BBdXRob3I6IERyYWdvbWlyIEFsZXhhbmRydSA8MTQ3MDU3ODM1K2RyYWdvbWlyYTItcHBiQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbT5ARGF0ZTogICBGcmkgSmFuIDI2IDE2OjU4OjE1IDIwMjQgKzAyMDBAQCAgICBVcGRhdGUgcmVsZWFzZS55bWxAQGNvbW1pdCBkMDcwNGJhMGFjMDU0ZDA1ZmEyNjgyOTJjNDE3MjFlZTQ5NjJjOWI0QEF1dGhvcjogZHJhZ29taXJhMiA8YWxleGFuZHJ1LmRyYWdvbWlyQHBwYi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNjo1NzoxNyAyMDI0ICswMjAwQEAgICAgTW9kaWZpZWQgcmVsZWFzZSB3b3JrZmxvdyBhY3Rpb25AQGNvbW1pdCBjM2Y3MDJlNTliNDU1MWVlMmE0ZTE1NzliMTMyNjliMmQyOTMwZDE0QEF1dGhvcjogZHJhZ29taXJhMiA8YWxleGFuZHJ1LmRyYWdvbWlyQHBwYi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNjo1NTo1NyAyMDI0ICswMjAwQEAgICAgTW9kaWZpZWQgcmVsZWFzZSB3b3JrZmxvdyBhY3Rpb25AQGNvbW1pdCA3MThlMzFlOWQ0ZjBhN2I2NzY5YjE3NWY0OWFlYzY4ZjZmZTg4NDJiQEF1dGhvcjogZHJhZ29taXJhMiA8YWxleGFuZHJ1LmRyYWdvbWlyQHBwYi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNjo1Mjo0MiAyMDI0ICswMjAwQEAgICAgTW9kaWZpZWQgcmVsZWFzZSB3b3JrZmxvdyBhY3Rpb25AQGNvbW1pdCAwNDNiODgyNmVmMDY4NzcyMjZhYzM4YzdiMjA2NDVlOGRjODk5OGIyQEF1dGhvcjogRHJhZ29taXIgQWxleGFuZHJ1IDwxNDcwNTc4MzUrZHJhZ29taXJhMi1wcGJAdXNlcnMubm9yZXBseS5naXRodWIuY29tPkBEYXRlOiAgIEZyaSBKYW4gMjYgMTY6Mjk6MjEgMjAyNCArMDIwMEBAICAgIFVwZGF0ZSByZWxlYXNlLnltbEBAY29tbWl0IDQ0OGM1NmRlODcyYmExYmUyOGFmNDAxMTllNTA5NjYyNjZkZGE4ZjJAQXV0aG9yOiBEcmFnb21pciBBbGV4YW5kcnUgPDE0NzA1NzgzNStkcmFnb21pcmEyLXBwYkB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNjoyNzo0NCAyMDI0ICswMjAwQEAgICAgVXBkYXRlIHJlbGVhc2UueW1sQEBjb21taXQgZGYzNjM1OThkMTk3ZmNkOWIzMzdjZjQwOTk1ZDVhMjc5MTVhYTIzOUBBdXRob3I6IGRyYWdvbWlyYTIgPGFsZXhhbmRydS5kcmFnb21pckBwcGIuY29tPkBEYXRlOiAgIEZyaSBKYW4gMjYgMTY6MTI6NDcgMjAyNCArMDIwMEBAICAgIE1vZGlmaWVkIHJlbGVhc2Ugd29ya2Zsb3cgYWN0aW9uQEBjb21taXQgNGExNjcxNjA2OWNhMmMwNGFlNzM5MTBkZjBmN2JmYmMyM2QyYmM0NkBBdXRob3I6IGRyYWdvbWlyYTIgPGFsZXhhbmRydS5kcmFnb21pckBwcGIuY29tPkBEYXRlOiAgIEZyaSBKYW4gMjYgMTY6MTE6MDggMjAyNCArMDIwMEBAICAgIE1vZGlmaWVkIHJlbGVhc2Ugd29ya2Zsb3cgYWN0aW9uQEBjb21taXQgNzFjZjA0NTIyMzQ2OWVlOWI4ZDYyZDljYzFhNzM5MDUwMzBlYjVkM0BBdXRob3I6IERyYWdvbWlyIEFsZXhhbmRydSA8MTQ3MDU3ODM1K2RyYWdvbWlyYTItcHBiQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbT5ARGF0ZTogICBGcmkgSmFuIDI2IDE2OjAwOjI5IDIwMjQgKzAyMDBAQCAgICBVcGRhdGUgcmVsZWFzZS55bWxAQGNvbW1pdCBjMGE5MDBjMGE4NzA3MTUyOGVhNWMwOTgyM2JjZTFmMGZkOGJhNzUyQEF1dGhvcjogRHJhZ29taXIgQWxleGFuZHJ1IDwxNDcwNTc4MzUrZHJhZ29taXJhMi1wcGJAdXNlcnMubm9yZXBseS5naXRodWIuY29tPkBEYXRlOiAgIEZyaSBKYW4gMjYgMTU6NTY6MDUgMjAyNCArMDIwMEBAICAgIFVwZGF0ZSByZWxlYXNlLnltbCAoIzMpQEBjb21taXQgODY3NWQyYjYyMmI5MjIxNWFjZmI1OWQwM2Y3ZjUyNWZlMDk0Njg0MEBBdXRob3I6IERyYWdvbWlyIEFsZXhhbmRydSA8MTQ3MDU3ODM1K2RyYWdvbWlyYTItcHBiQHVzZXJzLm5vcmVwbHkuZ2l0aHViLmNvbT5ARGF0ZTogICBGcmkgSmFuIDI2IDE1OjUxOjQ4IDIwMjQgKzAyMDBAQCAgICBVcGRhdGUgcmVsZWFzZS55bWxAQGNvbW1pdCAyNmZjZWRlZDhiMWExYTMyYzI4YmFmZDFkZWM1MWEwNmVhOGVjNmEyQEF1dGhvcjogZHJhZ29taXJhMiA8YWxleGFuZHJ1LmRyYWdvbWlyQHBwYi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNDoxODoyMiAyMDI0ICswMjAwQEAgICAgTW9kaWZpZWQgcmVsZWFzZSB3b3JrZmxvdyBhY3Rpb25AQGNvbW1pdCBjZjY2YTdhZTE5MDJlNTYxZTdmYWRlMTM2ODMwZWJhZWQ5OWViOWE5QEF1dGhvcjogZHJhZ29taXJhMiA8YWxleGFuZHJ1LmRyYWdvbWlyQHBwYi5jb20+QERhdGU6ICAgRnJpIEphbiAyNiAxNDoxNzowNCAyMDI0ICswMjAwQEAgICAgTW9kaWZpZWQgcmVsZWFzZSB3b3JrZmxvdyBhY3Rpb25ACg==').decode('utf-8')

    commit_data_list = []
    commit_pattern = re.compile(
        r'commit (\S+)\@Author: (.*?)\@Date:\s+([^\@]+)\@\@(.*?)(?=\@commit|\Z)', re.DOTALL)

    for match in commit_pattern.finditer(input_release_commits):
        commit_data = {
            "commit": match.group(1),
            "author": (re.compile(r'<(.*?)>').findall(match.group(2)))[0],
#             "date": datetime.strptime(match.group(3), "%a %b %d %H:%M:%S %Y %z").strftime("%d %b %Y - %H:%M"),
             "date": match.group(3),
            "commit_message": match.group(4).strip(),
        }
        commit_data_list.append(commit_data)

    return commit_data_list